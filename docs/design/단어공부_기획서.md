# 단어 공부 기능 기획서

## 1. 개요

### 1.1 목적
성경 암송을 위해 필수적인 영어 단어를 학습하는 기능. 암송 전에 단어를 익히면 암송 성공률이 높아짐.

### 1.2 타겟 사용자
- 영어 성경 암송을 준비하는 한국인 학습자
- 성경 영단어를 체계적으로 학습하고 싶은 사용자

### 1.3 핵심 가치
- **암송 연계**: 현재 학습 중인 구절의 단어 우선 학습
- **반복 학습**: 플래시카드 + 퀴즈로 장기 기억 유도
- **달란트 연동**: 단어 학습으로도 달란트 획득 가능

---

## 2. 기능 상세

### 2.1 단어 목록 화면

#### 진입 경로
메인 메뉴 > "단어 공부" 버튼

#### 화면 구성
```
┌─────────────────────────────┐
│  📚 단어 공부                │
├─────────────────────────────┤
│  [책 선택: 말라기 ▼]         │
│  [장 선택: 1장 ▼]            │
├─────────────────────────────┤
│  학습 진행률: 32/45 (71%)    │
│  ████████████░░░░░           │
├─────────────────────────────┤
│  ┌─────────────────────────┐ │
│  │ covenant (명)           │ │
│  │ 언약                    │ │
│  │ ⭐ 암기완료  🔊         │ │
│  └─────────────────────────┘ │
│  ┌─────────────────────────┐ │
│  │ messenger (명)          │ │
│  │ 전령, 사자              │ │
│  │ ☆ 학습중    🔊          │ │
│  └─────────────────────────┘ │
│  ...                        │
├─────────────────────────────┤
│  [📖 플래시카드] [📝 퀴즈]   │
└─────────────────────────────┘
```

#### 단어 카드 정보
- 영단어
- 품사 (명사, 동사, 형용사 등)
- 한글 뜻 (주요 의미 1-2개)
- 발음 기호 (선택)
- TTS 재생 버튼
- 암기 상태 (미학습 / 학습중 / 암기완료)

---

### 2.2 플래시카드 모드

#### 동작 방식
1. 카드 앞면: 영단어 + 발음 버튼
2. 탭하면 뒤집기: 한글 뜻 + 예문(성경 구절)
3. 스와이프로 다음 카드

#### 화면 구성
```
┌─────────────────────────────┐
│        앞면 (영어)          │
│                             │
│        covenant             │
│        /ˈkʌvənənt/          │
│                             │
│          🔊 듣기             │
│                             │
│      [탭하면 뜻 보기]        │
├─────────────────────────────┤
│   ← 이전    12/45    다음 → │
└─────────────────────────────┘
```

```
┌─────────────────────────────┐
│        뒷면 (한글)          │
│                             │
│         언약, 계약           │
│                             │
│   📖 "the covenant of the   │
│      fathers" (말 2:10)     │
│                             │
│   [😕 모름] [🤔 애매] [😊 암] │
├─────────────────────────────┤
│   ← 이전    12/45    다음 → │
└─────────────────────────────┘
```

#### 자기 평가 버튼
- **모름**: 다음 학습에서 우선 출제
- **애매함**: 2회 후 다시 출제
- **알고 있음**: 5회 후 복습용 출제

---

### 2.3 퀴즈 모드

#### 퀴즈 유형

**Type A: 영 → 한 (객관식)**
```
Q: "covenant"의 뜻은?

① 축복      ② 언약
③ 사랑      ④ 희생

[정답 확인]
```

**Type B: 한 → 영 (객관식)**
```
Q: "언약"을 영어로?

① blessing   ② covenant
③ sacrifice  ④ messenger

[정답 확인]
```

**Type C: 빈칸 채우기**
```
Q: 다음 빈칸에 들어갈 단어는?

"the _______ of the fathers"
(조상들의 언약)

[c][o][v][ ][ ][ ][ ][ ]
        ↑ 입력 중

[힌트 보기] [정답 확인]
```

**Type D: 듣고 맞추기 (TTS 활용)**
```
Q: 🔊 [들리는 단어 입력]

[ covenant  ]

[다시 듣기] [정답 확인]
```

#### 퀴즈 설정
- 문제 수: 10 / 20 / 전체
- 문제 유형: 전체 / 특정 유형만
- 난이도: 쉬움(4지선다) / 보통(입력) / 어려움(받아쓰기)

#### 결과 화면
```
┌─────────────────────────────┐
│        퀴즈 결과            │
│                             │
│     정답률: 85% (17/20)     │
│     획득 달란트: +5         │
│                             │
│   틀린 단어:                │
│   - covenant (언약)         │
│   - rebuke (꾸짖다)         │
│   - tithe (십일조)          │
│                             │
│  [틀린 단어 복습] [다시 풀기] │
└─────────────────────────────┘
```

---

### 2.4 단어 상세 화면

#### 카드 탭 시 표시
```
┌─────────────────────────────┐
│      covenant               │
│      /ˈkʌvənənt/    🔊      │
├─────────────────────────────┤
│  품사: 명사                  │
│  뜻: 언약, 계약, 서약        │
├─────────────────────────────┤
│  📖 등장 구절:               │
│                             │
│  "the covenant of the       │
│   fathers" - 말 2:10        │
│   (조상들의 언약)            │
│                             │
│  "my covenant with Levi"    │
│   - 말 2:4                  │
│   (레위와 세운 내 언약)       │
├─────────────────────────────┤
│  💡 암기 팁:                 │
│  "cover(덮다) + ant"        │
│  → 서로를 덮어주는 약속      │
├─────────────────────────────┤
│  [⭐ 즐겨찾기] [학습완료 표시] │
└─────────────────────────────┘
```

---

## 3. 데이터 구조

### 3.1 단어 데이터 모델

```dart
class BibleWord {
  final String id;              // 고유 ID
  final String word;            // 영단어
  final String pronunciation;   // 발음 기호
  final String partOfSpeech;    // 품사
  final List<String> meanings;  // 한글 뜻 (복수)
  final List<VerseReference> verses;  // 등장 구절
  final String? memoryTip;      // 암기 팁 (선택)
  final int difficulty;         // 난이도 1-5

  BibleWord({...});
}

class VerseReference {
  final String book;      // 책 ID
  final int chapter;      // 장
  final int verse;        // 절
  final String excerpt;   // 발췌 문장
  final String korean;    // 한글 번역
}
```

### 3.2 학습 진행 모델

```dart
class WordProgress {
  final String odId;         // 단어 ID
  final String userId;        // 사용자 ID
  final int correctCount;     // 맞춘 횟수
  final int totalAttempts;    // 시도 횟수
  final DateTime lastStudied; // 마지막 학습
  final WordStatus status;    // 상태
  final int streak;           // 연속 정답 횟수
}

enum WordStatus {
  notStarted,   // 미학습
  learning,     // 학습중
  mastered,     // 암기완료
}
```

### 3.3 퀴즈 결과 모델

```dart
class QuizResult {
  final String odId;
  final String bookId;
  final int chapter;
  final int totalQuestions;
  final int correctAnswers;
  final List<String> wrongWordIds;
  final int earnedTalants;
  final DateTime completedAt;
}
```

---

## 4. 단어 추출 전략

### 4.1 자동 추출 (Gemini AI 활용)

```dart
// Gemini에게 구절에서 학습할 단어 추출 요청
Future<List<ExtractedWord>> extractWordsFromVerse(String verse) async {
  final prompt = '''
  다음 ESV 성경 구절에서 한국인 학습자가 알아야 할 핵심 영단어를 추출해주세요.

  구절: "$verse"

  각 단어에 대해 다음 정보를 JSON 형식으로 제공:
  - word: 영단어
  - partOfSpeech: 품사 (noun, verb, adj, adv)
  - meanings: 한글 뜻 배열
  - difficulty: 난이도 1-5

  쉬운 기본 단어(the, is, a, and 등)는 제외하세요.
  ''';

  return await _gemini.generateContent(prompt);
}
```

### 4.2 단어 데이터 저장 위치

**Option A: 로컬 JSON 파일** (권장 - 오프라인 지원)
```
lib/data/
├── words/
│   ├── malachi_words.dart      // 말라기 단어
│   ├── philippians_words.dart  // 빌립보서 단어
│   └── hebrews_words.dart      // 히브리서 단어
```

**Option B: Firebase Firestore**
```
words/{wordId}
  - word, meanings, verses, ...
```

---

## 5. 달란트 연동

### 5.1 달란트 획득 조건

| 활동 | 달란트 |
|------|--------|
| 플래시카드 10장 완료 | +1 |
| 퀴즈 정답률 70% 이상 | +2 |
| 퀴즈 정답률 90% 이상 | +3 (추가 보너스) |
| 새 단어 10개 암기완료 | +2 |
| 일일 학습 목표 달성 | +1 |

### 5.2 일일 제한
- 단어 공부로 최대 10 달란트/일 획득 가능
- 암송 연습과 별도 카운트

---

## 6. 화면 네비게이션

```
MainMenuScreen
    │
    ├── "암송 연습" → BookSelectionScreen → ...
    │
    └── "단어 공부" → WordStudyHomeScreen (NEW)
                          │
                          ├── WordListScreen (단어 목록)
                          │       │
                          │       └── WordDetailScreen (상세)
                          │
                          ├── FlashcardScreen (플래시카드)
                          │
                          └── QuizScreen (퀴즈)
                                  │
                                  └── QuizResultScreen (결과)
```

---

## 7. 기술 구현 사항

### 7.1 새로 만들 파일

```
lib/
├── screens/
│   └── word_study/
│       ├── word_study_home_screen.dart    // 단어 공부 홈
│       ├── word_list_screen.dart          // 단어 목록
│       ├── word_detail_screen.dart        // 단어 상세
│       ├── flashcard_screen.dart          // 플래시카드
│       ├── quiz_screen.dart               // 퀴즈
│       └── quiz_result_screen.dart        // 퀴즈 결과
│
├── services/
│   ├── word_service.dart                  // 단어 데이터 관리
│   └── word_progress_service.dart         // 학습 진행 관리
│
├── models/
│   ├── bible_word.dart                    // 단어 모델
│   └── word_progress.dart                 // 진행 모델
│
├── data/
│   └── words/
│       ├── malachi_words.dart             // 말라기 단어 데이터
│       ├── philippians_words.dart         // 빌립보서 단어 데이터
│       └── ...
│
└── widgets/
    └── word_study/
        ├── word_card.dart                 // 단어 카드 위젯
        ├── flashcard_widget.dart          // 플래시카드 위젯
        └── quiz_option_button.dart        // 퀴즈 버튼 위젯
```

### 7.2 기존 파일 수정

```dart
// main_menu_screen.dart
// "단어 공부" 버튼의 onTap을 _showComingSoon에서 실제 네비게이션으로 변경

onTap: () => Navigator.push(
  context,
  MaterialPageRoute(
    builder: (_) => WordStudyHomeScreen(authService: widget.authService),
  ),
),
```

### 7.3 사용 API / 패키지

- **TTS**: 기존 `TTSService` 재사용 (단어 발음)
- **Gemini**: 기존 `GeminiService` 확장 (단어 추출, 암기 팁)
- **flip_card**: 플래시카드 애니메이션 (pub.dev)
- **shared_preferences**: 학습 진행 로컬 저장

---

## 8. 개발 우선순위

### Phase 1: 기본 구조 (MVP)
1. 단어 데이터 모델 생성
2. 말라기 1장 단어 데이터 작성 (수동)
3. 단어 목록 화면
4. 단어 상세 화면
5. TTS 연동

### Phase 2: 학습 기능
1. 플래시카드 모드
2. 학습 진행 저장
3. 간단 퀴즈 (영→한 객관식)

### Phase 3: 고급 기능
1. 다양한 퀴즈 유형
2. Gemini 단어 자동 추출
3. 달란트 연동
4. 일일 학습 목표

### Phase 4: 확장
1. 나머지 성경책 단어 데이터
2. 복습 알림 (로컬 알림)
3. 단어장 내보내기

---

## 9. UI/UX 고려사항

### 9.1 디자인 가이드라인
- 기존 앱과 일관된 색상 (Indigo 계열)
- 카드 기반 UI 유지
- 부드러운 애니메이션 (플래시카드 뒤집기)

### 9.2 접근성
- 충분한 터치 영역 (최소 48x48)
- 고대비 텍스트
- TTS 음성 속도 조절

### 9.3 오프라인 지원
- 단어 데이터 로컬 저장
- 학습 진행 오프라인 저장 후 동기화

---

## 10. 성공 지표

| 지표 | 목표 |
|------|------|
| 일일 활성 사용자 (DAU) | 단어 공부 진입률 30% |
| 플래시카드 완료율 | 70% 이상 |
| 퀴즈 평균 정답률 | 75% 이상 |
| 단어→암송 연계율 | 단어 학습 후 암송 시도율 50% |

---

## 부록: 말라기 1장 핵심 단어 예시

| 영단어 | 품사 | 한글 뜻 | 난이도 |
|--------|------|---------|--------|
| oracle | 명 | 신탁, 말씀 | 3 |
| burden | 명 | 짐, 부담 | 2 |
| covenant | 명 | 언약 | 4 |
| despise | 동 | 멸시하다 | 3 |
| profane | 동 | 모독하다 | 4 |
| offering | 명 | 제물 | 2 |
| blemish | 명 | 흠, 결점 | 4 |
| governor | 명 | 총독 | 2 |
| dread | 명/동 | 두려움, 두려워하다 | 3 |
| curse | 명/동 | 저주(하다) | 2 |

---

*작성일: 2025-01-25*
*버전: 1.0*
