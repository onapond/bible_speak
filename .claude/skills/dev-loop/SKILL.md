# Dev Loop Skill

기능 단위 개발 자동화 루프. 계획 → 구현 → 검증 → 빌드 → 배포 → 커밋 → 다음 기능을 반자동으로 순환한다.

## 호출

```
/dev-loop [기능설명]
```

기능설명을 생략하면 `docs/status/PROGRESS.md`에서 TODO를 읽어 사용자에게 질문한다.

---

## Phase 1: 계획

### 1-1. TODO 확인
- `docs/status/PROGRESS.md`를 읽어 현재 TODO 목록 파악
- 인자로 기능설명이 주어졌으면 그것을 사용
- 없으면 TODO 목록을 보여주고 사용자에게 "어떤 기능을 작업할까요?" 질문

### 1-2. 구현 방식 제시
- 구현 방식 2~3가지를 **비개발자가 이해할 수 있는 말**로 설명
- 각 방식의 장단점을 한줄로 요약
- 추천안 표시

### 1-3. 사용자 선택 대기
- **반드시 사용자가 방식을 선택할 때까지 멈춤** (자동 진행 금지)

---

## Phase 2: 구현

### 2-1. 영향 범위 보고
- 변경될 파일/기능 목록을 보여줌
- 부작용이 있으면 미리 안내 ("이 파일 건드리면 X 기능도 바뀝니다")

### 2-2. 단계별 구현
- 3단계 이하로 나눠서 구현
- 각 단계는 자동 진행 (실패 시에만 멈춤)
- 실패 시 원인 분석 후 대안 제시

---

## Phase 3: 검증

### 3-1. 정적 분석
```
flutter analyze
```
- **error** → 자동 수정 시도 (최대 3회)
  - 3회 실패 → 멈추고 사용자에게 상황 보고 + 대안 제시
- **info/warning만** → 통과, 계속 진행

### 3-2. 테스트
```
flutter test
```
- 테스트 파일이 존재하면 실행
  - 실패 → 자동 디버그 시도 (최대 3회)
  - 3회 실패 → 멈추고 사용자에게 상황 보고
- 테스트 파일이 없으면 → 스킵하고 계속 진행

---

## Phase 4: 빌드 & 배포

### 4-1. 빌드
```powershell
powershell -ExecutionPolicy Bypass -File build_web.ps1
```
- **반드시 `build_web.ps1` 사용** (API 키 주입 필수)
- `flutter build web` 직접 실행 절대 금지
- 빌드 실패 → 에러 분석 후 자동 수정 시도 (최대 3회)
- 3회 실패 → 멈추고 사용자에게 보고

### 4-2. 배포 확인 게이트
- **반드시 사용자에게 "배포 진행할까요?" 확인** (자동 진행 금지)
- 사용자가 거부하면 Phase 5(커밋)로 건너뛰기

### 4-3. 배포
```
firebase deploy --only hosting
```
- 배포 후 HTTP 200 응답 검증 (배포 URL 접속 확인)
- 실패 시 멈추고 보고

---

## Phase 5: 커밋 & 푸시

### 5-1. 보안 검사
- 스테이징 전 검사 대상:
  - `.env`, `.env.*` 파일
  - `credentials.json`, `service-account*.json`
  - API 키, 토큰이 하드코딩된 파일
- **보안 위반 발견 → 즉시 멈춤, 절대 자동 진행 안 함**

### 5-2. 선택적 스테이징
- 관련 파일만 개별 지정하여 `git add`
- `git add -A`, `git add .` 사용 금지

### 5-3. 커밋
- 변경 내용 분석 후 Conventional Commits 메시지 자동 생성
  - `feat:`, `fix:`, `chore:`, `docs:`, `refactor:`, `style:`, `perf:`
- 반드시 HEREDOC 방식으로 커밋 메시지 전달
```bash
git commit -m "$(cat <<'EOF'
커밋 메시지

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"
```

### 5-4. 푸시
```
git push origin [current-branch]
```
- `--force` push 절대 금지

---

## Phase 6: 루프

### 6-1. 다음 기능 질문
- "다음 기능이나 개선사항이 있나요?" 질문
- 있으면 → **Phase 1로 돌아감**

### 6-2. 종료
- 없으면 → 세션 요약 작성
  - `docs/status/sessions/YYYYMMDD.md` 업데이트
  - 완료된 작업, 수정된 파일, 다음 TODO 기록
- 종료 인사

---

## 실패 처리 공통 규칙

| 상황 | 행동 |
|------|------|
| 자동 수정 가능한 에러 | 최대 3회 재시도 |
| 3회 실패 | 멈추고 사용자에게 상황 보고 + 대안 제시 |
| 보안 위반 | 즉시 멈춤, 절대 자동 진행 안 함 |
| 빌드/배포 실패 | 에러 분석 후 수정 시도, 3회 실패 시 멈춤 |

## 금지 사항

- `git add -A`, `git add .` 사용 금지
- `.env`, credentials 파일 커밋 금지
- `flutter build web` 직접 실행 금지 (반드시 `build_web.ps1`)
- `--force` push 금지
- 사용자 확인 없이 배포 금지
- Phase 1 계획 선택을 자동으로 결정하지 않음

## 멈추는 지점 (사용자 확인 필수)

1. **Phase 1**: 구현 방식 선택
2. **Phase 4**: 배포 진행 여부
